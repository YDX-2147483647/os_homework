# è¯»è€…å†™è€…é—®é¢˜

## ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹

### æŸ¥çœ‹å¸®åŠ©

```powershell
> cargo run -- --help
ex_2 0.1.0

USAGE:
    ex_2.exe [OPTIONS] <POLICY>

ARGS:
    <POLICY> â€¦â€¦
â€¦â€¦â€¦â€¦
```

è‹¥æ²¡æœ‰ [Cargo](https://doc.rust-lang.org/cargo/index.html)ï¼Œå¯è¾“å…¥`/target/release/ex_2.exe --help`ï¼Œå³å°†`cargo run --`æ›¿æ¢ä¸º`./target/release/ex_2.exe`ï¼ŒååŒã€‚

### æŒ‰â€œè¯»è€…ä¼˜å…ˆâ€ç­–ç•¥å¤„ç†`mixed.in`

```powershell
> cat ./test_cases/mixed.in | cargo run -- read-preferring
 0.000 s | #1ï¼šğŸš€åˆ›å»ºã€‚
â€¦â€¦â€¦â€¦
 3.013 s | #1ï¼šğŸ””ğŸ‘€ç”³è¯·è¯»å–ã€‚
 3.013 s | #1ï¼šğŸğŸ‘€å¼€å§‹è¯»å–ã€‚
 4.000 s | #2ï¼šğŸ””ğŸ“ç”³è¯·å†™å…¥ã€‚
â€¦â€¦â€¦â€¦
```

- ç­–ç•¥å¯ä»¥æ˜¯è¯»è€…ä¼˜å…ˆï¼ˆ`read-preferring`ï¼‰ã€å†™è€…ä¼˜å…ˆï¼ˆ`write-preferring`ï¼‰ã€å…¬å¹³ç«äº‰ï¼ˆ`unspecified-priority`ï¼‰ã€‚

- `mixed.in`æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹æ˜¯é©¬è€å¸ˆæˆ–ç‹è€å¸ˆæä¾›çš„æµ‹è¯•è¾“å…¥ã€‚

  ```powershell
  > cat .\test_cases\mixed.in
  1 R 3 5
  2 W 4 5
  3 R 5 2
  4 R 6 5
  5 W 5.1 3
  ```

  æ ¼å¼å¦‚ä¸‹ã€‚

  > æµ‹è¯•æ•°æ®æ–‡ä»¶åŒ…æ‹¬ n è¡Œæµ‹è¯•æ•°æ®ï¼Œåˆ†åˆ«æè¿°åˆ›å»ºçš„ n ä¸ªçº¿ç¨‹æ˜¯è¯»è€…è¿˜æ˜¯å†™è€…ï¼Œä»¥åŠè¯»å†™æ“ä½œçš„å¼€å§‹æ—¶é—´å’ŒæŒç»­æ—¶é—´ã€‚
  >
  > æ¯è¡Œæµ‹è¯•æ•°æ®åŒ…æ‹¬å››ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µé—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚
  >
  > 1. ç¬¬1ä¸ªå­—æ®µä¸ºæ­£æ•´æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹çš„åºå·ã€‚
  > 2. ç¬¬2ä¸ªå­—æ®µè¡¨ç¤ºçº¿ç¨‹çš„è§’è‰²ï¼ŒRè¡¨ç¤ºè¯»è€…ï¼ŒWè¡¨ç¤ºå†™è€…ã€‚
  > 3. ç¬¬3ä¸ªå­—æ®µä¸ºä¸€ä¸ªæ­£æ•°ï¼Œè¡¨ç¤ºè¯»å†™å¼€å§‹æ—¶é—´ï¼šçº¿ç¨‹åˆ›å»ºåï¼Œå»¶è¿Ÿç›¸åº”æ—¶é—´ï¼ˆå•ä½ä¸ºç§’ï¼‰åå‘å‡ºå¯¹å…±äº«èµ„æºçš„è¯»å†™ç”³è¯·ã€‚
  > 4. ç¬¬4ä¸ªå­—æ®µä¸ºä¸€ä¸ªæ­£æ•°ï¼Œè¡¨ç¤ºè¯»å†™æ“ä½œçš„å»¶è¿Ÿæ—¶é—´ã€‚å½“çº¿ç¨‹è¯»å†™ç”³è¯·æˆåŠŸåï¼Œå¼€å§‹å¯¹å…±äº«èµ„æºè¿›è¡Œè¯»å†™æ“ä½œï¼Œè¯¥æ“ä½œæŒç»­ç›¸åº”æ—¶é—´åç»“æŸï¼Œé‡Šæ”¾è¯¥èµ„æºã€‚

- è¾“å‡ºè¿è¡Œè®°å½•ã€‚

  æ ¼å¼å¦‚ä¸‹ã€‚

  ```
   4.000 s | #2ï¼šğŸ””ğŸ“ç”³è¯·å†™å…¥ã€‚
  <è‡ªè¿è¡Œå¼€å§‹çš„æ—¶é—´> | #<æ“ä½œå‘˜ id>ï¼š<åŠ¨ä½œ>ã€‚
  ```

  åŠ¨ä½œæœ‰ä»¥ä¸‹å‡ ç§ã€‚

  - ğŸš€åˆ›å»º
  - ğŸ””ç”³è¯·â€¦â€¦
  - ğŸå¼€å§‹â€¦â€¦
  - ğŸ›‘ç»“æŸâ€¦â€¦
  - ğŸ‘€â€¦â€¦è¯»å–
  - ğŸ“â€¦â€¦å†™å…¥

ä¹Ÿå¯ç›´æ¥`cargo run -- read-preferring`ï¼Œç„¶åä¸€è¡Œä¸€è¡Œè¾“å…¥`1 R 3 5`ä¹‹ç±»çš„ï¼Œæœ€åæŒ‰<kbd>Ctrl</kbd>+<kbd>Z</kbd>ç»“æŸè¾“å…¥ã€‚

### æ‰“å°ä¿¡æ¯æ—¶ç¼©è¿›

```powershell
> cat ./test_cases/gap.in | cargo run -- write-preferring --tab 10
 0.000 s |          #1ï¼šğŸš€åˆ›å»ºã€‚
 0.000 s |                    #2ï¼šğŸš€åˆ›å»ºã€‚
â€¦â€¦â€¦â€¦
 1.014 s |          #1ï¼šğŸ””ğŸ‘€ç”³è¯·è¯»å–ã€‚
 1.014 s |          #1ï¼šğŸğŸ‘€å¼€å§‹è¯»å–ã€‚
 1.529 s |          #1ï¼šğŸ›‘ğŸ‘€ç»“æŸè¯»å–ã€‚
 3.008 s |                    #2ï¼šğŸ””ğŸ“ç”³è¯·å†™å…¥ã€‚
 3.009 s |                    #2ï¼šğŸğŸ“å¼€å§‹å†™å…¥ã€‚
 3.517 s |                    #2ï¼šğŸ›‘ğŸ“ç»“æŸå†™å…¥ã€‚
 â€¦â€¦â€¦â€¦
```

- `tab`é€‰é¡¹çš„å€¼æ§åˆ¶æ‰“å°ä¿¡æ¯æ—¶æ¯ä¸ªè¿›ç¨‹ç¼©è¿›çš„æ•°é‡ã€‚

  è¿™æ ·æ¯ä½æ“ä½œå‘˜ç‹¬å ä¸€åˆ—ï¼Œçœ‹èµ·æ¥æ›´ç®€å•ï¼Œ

  ä¾‹å¦‚`--tab 10`è¡¨ç¤ºæ“ä½œå‘˜ #1 ç¼©è¿› 1Ã—10 = 10 ä¸ªç©ºæ ¼ï¼Œæ“ä½œå‘˜ #2 ç¼©è¿› 20 ä¸ªç©ºæ ¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚

- `gap.in`æ˜¯å¦ä¸€ä¸ªæµ‹è¯•è¾“å…¥ã€‚

### Gantt å›¾

```powershell
> cat ./test_cases/mixed.in | cargo run -- read-preferring
â€¦â€¦â€¦â€¦
19.025 s | #5ï¼šğŸ›‘ğŸ“ç»“æŸå†™å…¥ã€‚
I've copied to your clipboard. Try to paste it into https://mermaid.live/ .
```

è¿è¡Œå®Œåï¼Œä½ çš„å‰ªè´´æ¿å†…å®¹ä¼šç±»ä¼¼ä¸‹é¢è¿™æ ·ã€‚

```
gantt
dateFormat ss.SSS
axisFormat %S.%L s

section 1
ğŸš€: milestone, 00.000, 0
ğŸ””ğŸ‘€: milestone, 01.014, 0
ğŸ‘€: 01.014, 01.529

â€¦â€¦â€¦â€¦
```

è®¿é—® [Mermaid Live Editor (mermaid.live)](https://mermaid.live/)ï¼Œç²˜è´´åˆ° Code ä¸€æ ï¼Œå¯åœ¨ Diagram ä¸€æ ç”»å‡º Gantt å›¾ã€‚

![](ReadMe.assets/mermaid_live.png)

## å¼€å‘ç›¸å…³çš„é“¾æ¥

- The Rust Book, [Shared state concurrency](https://doc.rust-lang.org/book/ch16-03-shared-state.html).
- Stack Overflow, [Deprecation of `std::sync::Semaphore` and its reason](https://stackoverflow.com/questions/59480070/replacement-for-stdsyncsemaphore-since-it-is-deprecated).
- Docs.rs, [`tokio::sync::Semaphore`](https://docs.rs/tokio/latest/tokio/sync/struct.Semaphore.html).
- Docs.rs, [`semaphore::Semaphore`](https://docs.rs/semaphore/latest/semaphore/struct.Semaphore.html).
